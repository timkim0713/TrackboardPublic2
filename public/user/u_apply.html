<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Trackboard</title>
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.12.0/css/all.css"
    />
    <!-- Vendor CSS Files -->
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet" />
    <link
      href="../assets/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/animate.css/animate.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet" />
    <link
      href="../assets/vendor/owl.carousel/assets/owl.carousel.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Bonbon&display=swap"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link href="../assets/css/style.css" rel="stylesheet" />
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <link href="../staff/sidebar-style.css" rel="stylesheet" />

    <script>
      $(function () {
        $("#header").load("../include/user_header.html");
        $("#footer").load("../include/user_footer.html");
      });
    </script>
  </head>
  <body>
    <!-- Run 'firebase serve' and open localhost to see header and footer, otherwise you get CORS error  -->
    <div id="header"></div>

    <button class="openbtn" id="openbtn" onclick="openNav()">
      â˜°
    </button>
    <div id="mySidebar" class="sidebar">
      <a
        href="javascript:void(0)"
        class="closebtn"
        onclick="closeNav()"
        style="
          padding: 8px 8px 8px 32px;
          text-decoration: none;
          font-size: 25px;
          box-shadow: 0px 0px 10px rgba(0, 0, 0, 0);
        "
      >
        x
      </a>
      <a href="u_apply.html" class="currentPage">Apply</a>
      <a href="u_history.html">History</a>
      <a href="u_rules.html">Poster Rules</a>
    </div>
    <br />
    <div id="main_content">
      <div
        class="container"
        style="background: rgba(226, 226, 226, 0.21); padding: 40px;"
      >
        <form action="u_history.html">
          <div class="section-title">
            <br />

            <h2>POSTER APPLICATION</h2>
          </div>
          <!-- <h1 class="page-header text-center">Poster Application</h1> -->
          <small style="color: cornflowerblue;"
            >* Please check all the requirements of the poster before submitting
            the application. Poster rules can be at
            <a
              style="
                font-size: 16px;
                color: rgb(255, 193, 7);
                font-weight: bold;
              "
              href="u_rules.html"
            >
              Poster Rules</a
            >
            in the sidebar.
          </small>
          <hr />
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label for="name"><strong>Name</strong></label>
                <input
                  class="form-control"
                  type="text"
                  id="name"
                  placeholder="e.g. John Doe"
                  required
                />
              </div>
              <div class="form-group">
                <label for="club"><strong>Organisation</strong></label>
                <input
                  class="form-control"
                  type="text"
                  id="club"
                  placeholder="e.g. SUNY Korea Startup Club or Student"
                  required
                />
              </div>
              <div class="form-group">
                <label for="email"><strong>Email</strong></label>
                <input
                  class="form-control"
                  type="email"
                  id="email"
                  placeholder="e.g. John.Doe@stonybrook.edu"
                  required
                />
              </div>
              <div class="form-group">
                <label for="purpose"
                  ><strong>What is the purpose of the poster?</strong></label
                >
                <textarea
                  class="form-control"
                  id="purpose"
                  placeholder="e.g. To recruit new members"
                  name="purpose"
                  cols="60"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="form-group">
                <label><strong>Select Poster Size:</strong></label>
                <br />
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="sizeOptions"
                    id="size1"
                    value="A3"
                  />
                  <label class="form-check-label" for="size1">A3</label>
                </div>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="sizeOptions"
                    id="size2"
                    value="A4"
                  />
                  <label class="form-check-label" for="size2">A4</label>
                </div>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="sizeOptions"
                    id="size3"
                    value="other"
                  />
                  <label class="form-check-label" for="size3">Other: </label>
                  &nbsp
                  <input
                    class="form-control form-control-sm"
                    type="text"
                    name="sizeOptions"
                    id="size3Other"
                    placeholder="e.g. 400mm x 300mm"
                  />
                </div>
              </div>
              <div class="form-group row">
                <label for="postDate" class="col-sm-4 col-form-label"
                  ><strong>Post Date:</strong></label
                >
                <div class="col-sm-8">
                  <input
                    type="date"
                    class="form-control-plaintext"
                    id="postDate"
                    required
                  />
                </div>
              </div>
              <div class="form-group row">
                <label for="takeDownDate" class="col-sm-4 col-form-label"
                  ><strong>Take Down Date:</strong></label
                >
                <div class="col-sm-8">
                  <input
                    type="date"
                    class="form-control-plaintext"
                    id="takeDownDate"
                    required
                  />
                </div>
              </div>
              <div>
                <div class="form-group">
                  <label><strong>Select Poster Locations: </strong></label>
                  <div class="form control">
                    <div>
                      <table class="table" id="tableLocations"></table>
                    </div>
                    <button
                      class="btn btn-warning"
                      type="button"
                      data-toggle="modal"
                      data-target="#locationModal"
                      aria-hidden="true"
                    >
                      Add Location
                    </button>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="specialRequest"
                  ><strong
                    >Do you have any special location request?</strong
                  ></label
                >
                <textarea
                  class="form-control"
                  id="specialRequest"
                  placeholder="e.g. C202 Door when the event is happening"
                  name="specialRequest"
                  cols="60"
                  rows="3"
                ></textarea>
              </div>
            </div>
            <div class="col 5">
              <div class="container text-center">
                <div class="custom-file">
                  <input
                    type="file"
                    accept="image/*"
                    name="image"
                    id="file"
                    onchange="readURL(this);"
                    hidden
                  />
                  <br />
                  <label
                    class="btn btn-warning"
                    for="file"
                    style="cursor: pointer;"
                    >Upload Poster</label
                  >
                  <br />
                  <p>
                    <br /><img id="outputIMG" width="450" height="auto" ; />
                  </p>
                </div>
              </div>
            </div>
          </div>

          <button
            class="btn btn-info"
            id="submit"
            type="submit"
            style="float: right;"
            onclick="submitApp(event)"
          >
            Submit Application
          </button>
          <br />
          <br />
        </form>
        <br />
      </div>
    </div>
    <div id="footer"></div>

    <!-- The Modal -->
    <div
      class="modal fade"
      id="locationModal"
      aria-hidden="true"
      aria-labelledby="Select Poster Location Modal"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <h2 class="modal-title">Select Poster Location</h2>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <h4>Browse Location:</h4>
            <br />
            <div class="dropdown" style="display: inline;">
              <button
                class="btn btn-warning dropdown-toggle"
                type="button"
                id="locationCampus"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Campus
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" value="IGC" href="#">IGC</a>
                <a class="dropdown-item" value="SUNY" href="#">SUNY</a>
              </div>
            </div>
            <div class="dropdown" style="display: inline;">
              <button
                class="btn btn-info dropdown-toggle"
                type="button"
                id="locationBuilding"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Building
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" value="Building A" href="#"
                  >Building A</a
                >
                <a class="dropdown-item" value="Building B" href="#"
                  >Building B</a
                >
                <a class="dropdown-item" value="Building C" href="#"
                  >Building C</a
                >
              </div>
            </div>
            <div class="dropdown" style="display: inline;">
              <button
                class="btn btn-info dropdown-toggle"
                type="button"
                id="locationFloor"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Floor
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" value="Floor 1" href="#">Floor 1</a>
                <a class="dropdown-item" value="Floor 2" href="#">Floor 2</a>
                <a class="dropdown-item" value="Floor 3" ref="#">Floor 3</a>
              </div>
            </div>
            <div class="dropdown" style="display: inline;">
              <button
                class="btn btn-info dropdown-toggle"
                type="button"
                id="locationBoard"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                Board
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" value="Board 1" href="#">Board 1</a>
                <a class="dropdown-item" value="Board 2" href="#">Board 2</a>
                <a class="dropdown-item" value="Board 3" href="#">Board 3</a>
              </div>
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
              aria-label="Cancel"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-info"
              data-dismiss="modal"
              aria-label="Add Location"
              onclick="addlocation()"
            >
              Add
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-storage.js"></script>

    <!-- <script src="../include/init_firebase.js"></script> -->
    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyBveio8IuFGOMymSnwNgAWqc14BVliUwHY",
        authDomain: "trackboard-d41a2.firebaseapp.com",
        databaseURL: "https://trackboard-d41a2.firebaseio.com",
        projectId: "trackboard-d41a2",
        storageBucket: "trackboard-d41a2.appspot.com",
        messagingSenderId: "880705427344",
        appId: "1:880705427344:web:43e253a149143cc9218515",
        measurementId: "G-5GLK0MX33D",
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();

      var st = firebase.storage();
      var db = firebase.firestore();
    </script>

    <script>
      const colRef = db.collection("applications");
      var posterIMG;

      $(document).ready(function () {});

      $(".dropdown").each(function (key, dropdown) {
        var $dropdown = $(dropdown);
        $dropdown.find(".dropdown-menu a").on("click", function () {
          $dropdown.find("button").text($(this).text());
        });
      });

      function readURL(input) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function (e) {
            $("#outputIMG").attr("src", e.target.result).width(450).height(550);
          };

          reader.readAsDataURL(input.files[0]);
          posterIMG = input.files[0];
        }
      }

      function addlocation() {
        var e = document.getElementById("locationCampus");
        var campus = e.firstChild.data;
        e = document.getElementById("locationBuilding");
        var build = e.firstChild.data;
        e = document.getElementById("locationFloor");
        var floor = e.firstChild.data;
        e = document.getElementById("locationBoard");
        var board = e.firstChild.data;

        var table = document.getElementById("tableLocations");
        var row = table.insertRow();
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);

        row.setAttribute("scope", "row");

        cell1.innerText = campus.trim();
        cell2.innerText = build.trim();
        cell3.innerText = floor.trim();
        cell4.innerText = board.trim();
        cell5.innerHTML =
          "<button type='button' class='btn btn-secondary' onclick='deleteRow()'>Delete</button>";
      }

      function deleteRow() {
        var td = event.target.parentNode;
        var tr = td.parentNode;
        tr.parentNode.removeChild(tr);
      }

      function submitApp(e) {
        e.preventDefault();
        let name = document.getElementById("name").value;
        let club = document.getElementById("club").value;
        let email = document.getElementById("email").value;
        let reason = document.getElementById("purpose").value;
        let size = document.querySelector('input[name="sizeOptions"]:checked')
          .value;
        if (size == "other") {
          size = document.getElementById("size3Other").value;
        }
        let postDate = document.getElementById("postDate").value;
        let takeDownDate = document.getElementById("takeDownDate").value;
        let table = document.getElementById("tableLocations");
        let locations = [];
        for (var i = 0, row; (row = table.rows[i]); i++) {
          let x = {
            campus: row.cells[0].innerText,
            building: row.cells[1].innerText,
            floor: row.cells[2].innerText,
            board: row.cells[3].innerText,
          };
          locations.push(x);
        }
        let specialRequest = document.getElementById("specialRequest").value;

        var metadata = {
          contentType: posterIMG.type,
        };

        colRef
          .add({
            submitted_by: name,
            club: club,
            email: email,
            reason: reason,
            size: size,
            postDate: postDate,
            takeDownDate: takeDownDate,
            locations: locations,
            specialRequest: specialRequest,
            appDate: Date.now(),
            approved: "",
            comment: "",
          })
          .then(function (docRef) {
            let storageRef = st.ref().child("Posters/" + docRef.id);
            var task = storageRef.put(posterIMG, metadata);

            // Listen for state changes, errors, and completion of the upload.
            task.on(
              "state_changed",
              function progress(snapshot) {
                $("main_content").hide(); //supposed to hide the main content div while img is being uploaded to storage but doesn't
              },
              function err(error) {},
              function completed() {
                window.location.href = "u_history.html";
              }
            );
          });
      }
    </script>
    <script src="../staff/sidebar.js"></script>

    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
  </body>
</html>
