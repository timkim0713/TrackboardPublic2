<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Trackboard</title>
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.12.0/css/all.css"
    />
    <!-- Vendor CSS Files -->
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet" />
    <link
      href="../assets/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/animate.css/animate.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet" />
    <link
      href="../assets/vendor/owl.carousel/assets/owl.carousel.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Bonbon&display=swap"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link href="../assets/css/style.css" rel="stylesheet" />
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
    <link href="../staff/sidebar-style.css" rel="stylesheet" />

    <script>
      $(function () {
        $("#header").load("../include/user_header.html");
        $("#footer").load("../include/user_footer.html");
      });
    </script>
  </head>
  <body>
    <!-- Run 'firebase serve' and open localhost to see header and footer, otherwise you get CORS error  -->
    <div id="header"></div>

    <button class="openbtn" id="openbtn" onclick="openNav()">
      â˜°
    </button>
    <div id="mySidebar" class="sidebar">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"> x </a>
      <a href="u_apply.html">Apply</a>
      <a href="u_history.html">History</a>
      <a href="u_rules.html">Poster Rules</a>
    </div>
    <br />
    <div id="main_content">
      <div
        class="container"
        style="background: rgba(226, 226, 226, 0.21); padding: 40px;"
      >
        <form>
          <div class="section-title">
            <br />
            <h2>Currently Progressing Application</h2>
          </div>
          <div class="float-left">
            <div class="form-group">
              <label for="name"><strong>Name</strong></label>
              <input
                class="form-control"
                type="text"
                name="name"
                id="name"
                placeholder="Tim Kim"
                disabled
                required
              />
            </div>
            <div class="form-group">
              <label for="club"><strong>Organisation</strong></label>
              <input
                class="form-control"
                type="text"
                id="club"
                name="club"
                placeholder="SUNY Korea CS"
                disabled
                required
              />
            </div>
            <div class="form-group">
              <label for="email"><strong>Email</strong></label>
              <input
                class="form-control"
                type="email"
                id="email"
                name="email"
                placeholder="daekyung.kim@stonybrook.edu"
                disabled
                required
              />
            </div>
            <div class="form-group">
              <label for="purpose"
                ><strong>What is the purpose of the poster?</strong></label
              >
              <textarea
                class="form-control"
                id="purpose"
                placeholder="Eg. To recruit new members"
                name="purpose"
                cols="60"
                rows="3"
                disabled
                autofocus
              ></textarea>
            </div>
            <div class="form-group">
              <label><strong>Select Poster Size:</strong></label>
              <br />
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="sizeOptions"
                  id="size1"
                  disabled
                  value="A3"
                />
                <label class="form-check-label" for="size1">A3</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="sizeOptions"
                  id="size2"
                  disabled
                  value="A4"
                />
                <label class="form-check-label" for="size2">A4</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  name="sizeOptions"
                  id="size3"
                  disabled
                  value="other"
                />
                <label class="form-check-label" for="size3">Other:</label>
                &nbsp
                <input
                  class="form-control form-control-sm"
                  type="text"
                  name="sizeOptions"
                  id="size3Other"
                  disabled
                  placeholder="Eg. 400mmx300mm"
                />
              </div>
            </div>
            <div class="form-group row">
              <label for="postDate" class="col-sm-4 col-form-label"
                ><strong>Post Date:</strong></label
              >
              <div class="col-sm-8">
                <input
                  type="date"
                  class="form-control-plaintext"
                  id="postDate"
                  disabled
                />
              </div>
            </div>
            <div class="form-group row">
              <label for="takeDownDate" class="col-sm-4 col-form-label"
                ><strong>Take Down Date:</strong></label
              >
              <div class="col-sm-8">
                <input
                  type="date"
                  class="form-control-plaintext"
                  id="takeDownDate"
                  disabled
                />
              </div>
            </div>
            <div>
              <div class="form-group">
                <label><strong>Select Poster Locations: </strong></label>
                <div class="form control">
                  <div>
                    <table class="table" id="tableLocations"></table>
                  </div>
                  <button
                    class="btn btn-primary"
                    type="button"
                    data-toggle="modal"
                    data-target="#locationModal"
                    aria-hidden="true"
                    disabled
                  >
                    Add Location
                  </button>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="specialRequest"
                ><strong
                  >Do you have any special location request?</strong
                ></label
              >
              <textarea
                class="form-control"
                id="specialRequest"
                placeholder="Eg. C202 Door when the event is happening"
                name="specialRequest"
                cols="60"
                rows="3"
                disabled
              ></textarea>
            </div>
          </div>
          <div class="float-right">
            <div class="container text-center">
              <div class="custom-file">
                <p><img id="outputIMG" width="450" height="600" /></p>
              </div>
            </div>
          </div>
          <div class="clearfix"></div>
        </form>
      </div>
    </div>
    <div id="footer"></div>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.4/firebase-storage.js"></script>

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyBveio8IuFGOMymSnwNgAWqc14BVliUwHY",
        authDomain: "trackboard-d41a2.firebaseapp.com",
        databaseURL: "https://trackboard-d41a2.firebaseio.com",
        projectId: "trackboard-d41a2",
        storageBucket: "trackboard-d41a2.appspot.com",
        messagingSenderId: "880705427344",
        appId: "1:880705427344:web:43e253a149143cc9218515",
        measurementId: "G-5GLK0MX33D",
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
    </script>
    <script>
      var firestore = firebase.firestore();
      var st = firebase.storage();
      const docRef = firestore.collection("applications");

      $(document).ready(function () {
        var parameters = location.search.substring(1).split("&");
        var id;
        var temp = parameters[0].split("=");
        var tempId = unescape(temp[1]);

        if (typeof tempId !== "undefined") {
          id = tempId;

          docRef
            .doc(id)
            .get()
            .then(function (doc) {
              if (doc.exists) {
                showStuff(doc.data(), doc.id);
              } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
              }
            })
            .catch(function (error) {
              console.log("Error getting document:", error);
            });
        } else {
          docRef
            .orderBy("appDate", "desc")
            .limit(1)
            .get()
            .then((snapshot) => {
              snapshot.forEach((doc) => {
                showStuff(doc.data(), doc.id);
              });
            })
            .catch((err) => {
              console.log("Error getting documents", err);
            });
        }
      });

      function showStuff(data, id) {
        st.ref()
          .child("Posters/" + id)
          .getDownloadURL()
          .then(function (url) {
            // `url` is the download URL for 'images/stars.jpg'

            // This can be downloaded directly:
            var xhr = new XMLHttpRequest();
            xhr.responseType = "blob";
            xhr.onload = function (event) {
              var blob = xhr.response;
            };
            xhr.open("GET", url);
            xhr.send();

            // Or inserted into an <img> element:
            var img = document.getElementById("outputIMG");
            img.src = url;
          })
          .catch(function (error) {
            // Handle any errors
          });

        if (data.approved === false || data.approved === true) {
          document.getElementById("pageHeader").innerText =
            "Completed Application";
        }
        document.getElementById("name").value = data.submitted_by;
        document.getElementById("email").value = data.email;
        document.getElementById("club").value = data.club;

        document.getElementById("purpose").value = data.reason;
        if (data.size != "A3" || data.size != "A4") {
          //give other value
        } else {
        }
        document.getElementById("postDate").value = data.postDate;
        document.getElementById("takeDownDate").value = data.takeDownDate;

        data.locations.forEach(function (loc) {
          addlocation(loc.campus, loc.building, loc.floor, loc.board);
        });

        if (data.specialRequest == "") {
          document.getElementById("specialRequest").value = "  ";
        } else {
          document.getElementById("specialRequest").value = data.specialRequest;
        }
      }

      function addlocation(campus, build, floor, board) {
        var table = document.getElementById("tableLocations");
        var row = table.insertRow();
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);

        row.setAttribute("scope", "row");

        cell1.innerText = campus.trim();
        cell2.innerText = build.trim();
        cell3.innerText = floor.trim();
        cell4.innerText = board.trim();
      }
    </script>
    <script src="../staff/sidebar.js"></script>

    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
      crossorigin="anonymous"
    />
  </body>
</html>
