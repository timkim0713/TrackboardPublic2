<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Trackboard</title>
    <meta content="" name="descriptison">
    <meta content="" name="keywords">
    
    <!-- Favicons -->
    <link href="" rel="icon">
    <link href="" rel="apple-touch-icon">

    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/vendor/icofont/icofont.min.css" rel="stylesheet">
    <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="../assets/vendor/animate.css/animate.min.css" rel="stylesheet">
    <link href="../assets/vendor/venobox/venobox.css" rel="stylesheet">
    <link href="../assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.12.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Bonbon&display=swap" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="../assets/css/style.css" rel="stylesheet">

    <script src="..\assets\vendor\jquery\jquery.min.js"></script>

    <script>
      $(function(){
        $("#header").load("../include/staff_header.html"); 
        $("#aside").load("../include/staff_aside.html"); 
        $("#footer").load("../include/staff_footer.html"); 
      });
    </script> 
  </head>
  <body>
    <!-- Run 'firebase serve' and open localhost to see header and footer, otherwise you get CORS error  -->
    <div id="header"></div>
    <div id="aside" class=""></div>

     <!-- ======= Boards Section ======= -->
     <section id="portfolio" class="portfolio">
      <div class="container">

        <div class="section-title">
          <h2>BOARDS</h2>
          <p>Sit sint consectetur velit quisquam cupiditate impedit suscipit</p>
        </div>

        <!-- TODO DYNAMICALLY LOAD CONTENT !! Below is an example -->
        <div id="dropdownList">

        </div>

        <div id="posterBoardViewer" class="row portfolio-container" style="width: 1020px; max-height: 800px; background-color: #aaff99; overflow-y:auto; display: flex; justify-content: space-between;">
          <!-- TODO DYNAMICALLY LOAD CONTENT !! Below is an example -->

        </div>
      </div>
    </section><!-- End Portfolio Section -->


    <div id="footer"></div>

    <!-- Vendor JS Files -->
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="../assets/vendor/php-email-form/validate.js"></script>
    <script src="../assets/vendor/waypoints/jquery.waypoints.min.js"></script>
    <script src="../assets/vendor/counterup/counterup.min.js"></script>
    <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="../assets/vendor/venobox/venobox.min.js"></script>
    <script src="../assets/vendor/owl.carousel/owl.carousel.min.js"></script>

    <!-- Template Main JS File -->
    <script src="../assets/js/main.js"></script>
    <script>

      // var bfl = [];
      var bfl = [
        { building_id: "bd1", building_name: "Building A",
          floors: [
            { floor_id: "fl1", floor_name: "Main Floor",
              locations: [
                { location_id: "lc1", location_name: "Lounge" },
                { location_id: "lc2", location_name: "Student Service Office" },
              ]
            },
            { floor_id: "fl2", floor_name: "4th Floor",
              locations: [
                { location_id: "lc3", location_name: "Main Board" },
                { location_id: "lc4", location_name: "President Office" },
              ]
            }
          ]
        },
        { building_id: "bd2", building_name: "Building B",
          floors: [
            { floor_id: "fl3", floor_name: "MEOW Floor",
              locations: [
                { location_id: "lc5", location_name: "Lazy pool" },
                { location_id: "lc6", location_name: "Jacuzzi" },
              ]
            },
            { floor_id: "fl4", floor_name: "BLUB Floor",
              locations: [
                { location_id: "lc7", location_name: "Everland" },
                { location_id: "lc8", location_name: "Lotte World" },
              ]
            }
          ]
        },
        { building_id: "bd3", building_name: "Building C",
          floors: [
            { floor_id: "fl5", floor_name: "Main Floor",
              locations: [
                { location_id: "lc9", location_name: "Sleeping Spot" },
                { location_id: "lc10", location_name: "Tired Corner" },
              ]
            },
            { floor_id: "fl6", floor_name: "4th Floor",
              locations: [
                { location_id: "lc11", location_name: "Wall1" },
                { location_id: "lc12", location_name: "Wall2" },
              ]
            }
          ]
        }
      ];
      // var myPosters = [];
      this.myPosters = [
        { building_id: "bd1", floor_id: "fl1", location_id: "lc1",
          image_link: "../assets/img/posters/poster-1.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc1",
          image_link: "../assets/img/posters/poster-2.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc1",
          image_link: "../assets/img/posters/poster-3.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc1",
          image_link: "../assets/img/posters/poster-4.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc1",
          image_link: "../assets/img/posters/poster-5.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc1",
          image_link: "../assets/img/posters/poster-6.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc2",
          image_link: "../assets/img/posters/poster-7.jpeg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc2",
          image_link: "../assets/img/posters/poster-8.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc2",
          image_link: "../assets/img/posters/poster-9.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc2",
          image_link: "../assets/img/posters/poster-10.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc2",
          image_link: "../assets/img/posters/poster-11.jpg"
        },
        { building_id: "bd1", floor_id: "fl1", location_id: "lc2",
          image_link: "../assets/img/posters/poster-12.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc3",
          image_link: "../assets/img/posters/poster-13.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc3",
          image_link: "../assets/img/posters/poster-14.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc3",
          image_link: "../assets/img/posters/poster-15.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc3",
          image_link: "../assets/img/posters/poster-16.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc3",
          image_link: "../assets/img/posters/poster-17.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc3",
          image_link: "../assets/img/posters/poster-18.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc4",
          image_link: "../assets/img/posters/poster-19.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc4",
          image_link: "../assets/img/posters/poster-20.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc4",
          image_link: "../assets/img/posters/poster-21.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc4",
          image_link: "../assets/img/posters/poster-22.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc4",
          image_link: "../assets/img/posters/poster-23.jpg"
        },
        { building_id: "bd1", floor_id: "fl2", location_id: "lc4",
          image_link: "../assets/img/posters/poster-24.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc5",
          image_link: "../assets/img/posters/poster-25.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc5",
          image_link: "../assets/img/posters/poster-26.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc5",
          image_link: "../assets/img/posters/poster-27.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc5",
          image_link: "../assets/img/posters/poster-28.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc5",
          image_link: "../assets/img/posters/poster-29.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc5",
          image_link: "../assets/img/posters/poster-30.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc6",
          image_link: "../assets/img/posters/poster-31.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc6",
          image_link: "../assets/img/posters/poster-32.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc6",
          image_link: "../assets/img/posters/poster-33.jpg"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc6",
          image_link: "../assets/img/posters/poster-34.png"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc6",
          image_link: "../assets/img/posters/poster-35.png"
        },
        { building_id: "bd2", floor_id: "fl3", location_id: "lc6",
          image_link: "../assets/img/posters/poster-36.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc7",
          image_link: "../assets/img/posters/poster-37.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc7",
          image_link: "../assets/img/posters/poster-38.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc7",
          image_link: "../assets/img/posters/poster-39.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc7",
          image_link: "../assets/img/posters/poster-40.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc7",
          image_link: "../assets/img/posters/poster-1.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc7",
          image_link: "../assets/img/posters/poster-3.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc8",
          image_link: "../assets/img/posters/poster-5.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc8",
          image_link: "../assets/img/posters/poster-7.jpeg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc8",
          image_link: "../assets/img/posters/poster-9.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc8",
          image_link: "../assets/img/posters/poster-11.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc8",
          image_link: "../assets/img/posters/poster-13.jpg"
        },
        { building_id: "bd2", floor_id: "fl4", location_id: "lc8",
          image_link: "../assets/img/posters/poster-15.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc9",
          image_link: "../assets/img/posters/poster-17.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc9",
          image_link: "../assets/img/posters/poster-19.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc9",
          image_link: "../assets/img/posters/poster-21.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc9",
          image_link: "../assets/img/posters/poster-23.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc9",
          image_link: "../assets/img/posters/poster-25.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc9",
          image_link: "../assets/img/posters/poster-27.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc10",
          image_link: "../assets/img/posters/poster-29.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc10",
          image_link: "../assets/img/posters/poster-31.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc10",
          image_link: "../assets/img/posters/poster-33.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc10",
          image_link: "../assets/img/posters/poster-35.png"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc10",
          image_link: "../assets/img/posters/poster-37.jpg"
        },
        { building_id: "bd3", floor_id: "fl5", location_id: "lc10",
          image_link: "../assets/img/posters/poster-39.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc11",
          image_link: "../assets/img/posters/poster-2.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc11",
          image_link: "../assets/img/posters/poster-4.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc11",
          image_link: "../assets/img/posters/poster-6.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc11",
          image_link: "../assets/img/posters/poster-8.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc11",
          image_link: "../assets/img/posters/poster-10.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc11",
          image_link: "../assets/img/posters/poster-12.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc12",
          image_link: "../assets/img/posters/poster-14.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc12",
          image_link: "../assets/img/posters/poster-16.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc12",
          image_link: "../assets/img/posters/poster-18.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc12",
          image_link: "../assets/img/posters/poster-20.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc12",
          image_link: "../assets/img/posters/poster-22.jpg"
        },
        { building_id: "bd3", floor_id: "fl6", location_id: "lc12",
          image_link: "../assets/img/posters/poster-24.jpg"
        },
      ]
        
      var pos_1 = "<div class=\"portfolio-item filter-x wow fadeInUp\" style=\"display: inline; width: 250px;\"> <div class=\"portfolio-wrap\"> <figure> <img src=\"";
      var pos_2 = "\" class=\"img-fluid\" alt=\"\"> <a href=\"" ;
      var pos_3 = "\" data-gall=\"portfolioGallery\" class=\"link-preview venobox\" title=\"Preview\"><i class=\"bx bx-plus\"></i></a> <a href=\"\" class=\"link-details\" title=\"More Details\"><i class=\"bx bx-link\"></i></a> </figure><div class=\"portfolio-info\"> <h4><a href=\"\">Uploader</a></h4> <p>Poster Location</p> </div></div>  </div>";

      var selectedBuilding = "*";
      var selectedFloor = "*";
      var selectedLocation = "*";

      $( document ).ready(function() {
        // TODO call API and get full list of posters and bfl
        // this.bfl = [];
        this.myPosters = [];
        
        let myParams = getParams(window.location.href);
        // console.log(myParams);
        if( getBuildingName(myParams.bid) !== "All Buildings"  ){
          this.selectedBuilding = myParams.bid;
        } else {
          this.selectedBuilding = "*";
        }
        if( getFloorName(myParams.fid) !== "All Floors" ){
          this.selectedFloor = myParams.fid;
        } else {
          this.selectedFloor = "*";
        }
        if( getLocationName(myParams.lid) !== "All Locations" ){
          this.selectedLocation = myParams.lid;
        } else {
          this.selectedLocation = "*";
        }

        setDropdowns(selectedBuilding, selectedFloor, selectedLocation)
        
      });

      function setDropdowns(selB, selF, selL){
        let myBuildings = "";
        let myFloors = "";
        let myLocations = "";
        myBuildings = "<div id=\"buildingDropdownBtn\" class=\"dropdown\" style=\"display: inline-block;\"> <button type=\"button\" class=\"btn btn-primary dropdown-toggle\" data-toggle=\"dropdown\">" + getBuildingName(selB) + " </button> <div class=\"dropdown-menu\"> <a class=\"dropdown-item\" href=\"javascript:setDropdowns('*', '*', '*');\">All Buildings</a>";
        if( selB !== '*' ){
          myFloors = "<div id=\"floorDropdownBtn\" class=\"dropdown\" style=\"display: inline-block;\"> <button type=\"button\" class=\"btn btn-primary dropdown-toggle\" data-toggle=\"dropdown\">" + getFloorName(selF) + "</button> <div class=\"dropdown-menu\"> <a class=\"dropdown-item\" href=\"javascript:setDropdowns('" + selB + "', '*', '*');\">All Floors</a>";
        }
        if( selF !== '*' ){
          myLocations = "<div id=\"locationropdownBtn\" class=\"dropdown\" style=\"display: inline-block;\"> <button type=\"button\" class=\"btn btn-primary dropdown-toggle\" data-toggle=\"dropdown\">" + getLocationName(selL) + "</button> <div class=\"dropdown-menu\"> <a class=\"dropdown-item\" href=\"javascript:setDropdowns('" + selB + "', '" + selF + "', '*');\">All Locations</a>";
        }
        this.bfl.forEach(b => {
          myBuildings = myBuildings + "<a class=\"dropdown-item\" href=\"javascript:setDropdowns('" + b.building_id+ "',  '*',  '*');\">" + b.building_name+"</a>";
          if( selB === b.building_id ){
            b.floors.forEach(f => {
              myFloors = myFloors + "<a class=\"dropdown-item\" href=\"javascript:setDropdowns('"+selB+"', '" + f.floor_id + "',  '*');\">" + f.floor_name + "</a>";
              if( selF === f.floor_id ){
                f.locations.forEach(l => {
                  myLocations = myLocations + "<a class=\"dropdown-item\" href=\"javascript:setDropdowns('"+selB+"', '"+selF+"', '" + l.location_id + "');\">" + l.location_name + "</a>";
                });
              }
            });
          }
        });
        myBuildings = myBuildings + "</div></div>";
        if( selB !== '*' ){
          myFloors = myFloors + "</div></div>";
        }
        if( selF !== '*' ){
          myLocations = myLocations + "</div></div>";
        }
        var ddl = $('#dropdownList');
        ddl.html( myBuildings + myFloors + myLocations );
        updatePosterItems(selB, selF, selL);
      }

      function updatePosterItems(bid, fid, lid){
        
        var loadPosters = "";
        for( let p of this.myPosters ){
          if( !(   (bid === '*') 
                || (bid === p.building_id && fid === '*') 
                || (bid === p.building_id && fid === p.floor_id && lid === '*') 
                || (bid === p.building_id && fid === p.floor_id && lid === p.location_id) ) ){
            continue;
          }
          loadPosters = loadPosters + this.pos_1 + p.image_link + this.pos_2 + p.image_link + this.pos_3;
        }
        var pbv = $('#posterBoardViewer');
        pbv.html(loadPosters);
      }

      function getBuildingName(bid){ 
        if( bid === '*' ){ return "All Buildings"; }
        for( let b of this.bfl ){
          if(bid === b.building_id){
            return b.building_name;
          }
        }
        return "All Buildings";
      }
      function getFloorName(fid){ 
        if( fid === '*' ){ return "All Floors"; }
        for( let b of this.bfl ){
          for( let f of b.floors ){
            if(fid === f.floor_id){
              return f.floor_name;
            }
          }
        }
        return "All Floors";
      }
      function getLocationName(lid){
        if( lid === '*' ){ return "All Locations"; }
        for( let b of this.bfl ){
          for( let f of b.floors ){
            for( let l of f.locations ){
              if(lid === l.location_id){
                return l.location_name;
              }
            }
          }
        }
        return "All Locations";
      }


      function updateViewer(bid, fid, lid){
        var pbv = $('#posterBoardViewer');
        pbv.html( this.generateBody(bid, fid, lid) );
      }

      function generateBody(bid, fid, lid){
        myBody = "";
        this.myPosters.forEach(p => {
          if( (bid === "*" || p.building_id === bid) && (fid === "*" || p.floor_id === fid) && (lid === "*" ||  p.location_id === lid) ){
            myBody = myBody + pos_1 + pos_3 + p.image_link + pos_4 + p.image_link + pos_5;
          } 
        });
        return myBody;
      }

      /**
      * Get the URL parameters
      * source: https://css-tricks.com/snippets/javascript/get-url-variables/
      * @param  {String} url The URL
      * @return {Object}     The URL parameters
      */
      var getParams = function (url) {
        var params = {};
        var parser = document.createElement('a');
        parser.href = url;
        var query = parser.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split('=');
          params[pair[0]] = decodeURIComponent(pair[1]);
        }
        return params;
      };
    </script>
  </body>
</html>